# Maintainer: t3ddy  <t3ddy1988 "at" gmail {dot} com>
# Contributor: Lex Rivera aka x-demon <aur@x-demon.org>                

pkgname=google-chrome-dev
pkgver=10.0.612.1
pkgrel=1
pkgdesc="Google Chrome Developer preview channel for Linux"
arch=('i686' 'x86_64')
url="http://dev.chromium.org/getting-involved/dev-channel"
license=('custom:chrome')
depends=('gcc-libs' 'gtk2' 'nss' 'gconf' 'libjpeg6' 'freetype2' 'cairo' 'libpng12' 'alsa-lib' 'libxss' 'hicolor-icon-theme')
optdepends=('gecko-mediaplayer')
install=${pkgname}.install

_channel='unstable'

if [ "$CARCH" = "i686" ]; then
    _arch='i386'
    source=("http://dl.google.com/linux/direct/google-chrome-${_channel}_current_${_arch}.deb")
    md5sums=('1d7788832c1369f389198ace27a3e46c')
elif [ "$CARCH" = "x86_64" ]; then
    _arch='amd64'
    source=("http://dl.google.com/linux/direct/google-chrome-${_channel}_current_${_arch}.deb")
    md5sums=('0efbe6e519a9e18b299fb1b5e32779ea')
fi

build() {
    msg "Extracting Google Chrome"
    ar -xv google-chrome-${_channel}_current_${_arch}.deb
    tar -xvf data.tar.lzma
    msg2 "Done extracting!"

    msg "Preparing install"
    mkdir -p $pkgdir/opt $pkgdir/usr/bin $pkgdir/usr/share/applications $pkgdir/usr/lib
    mv -v opt/google $pkgdir/opt
    msg2 "Done preparing!"

    msg "Actual installation"
    cd $pkgdir/usr/bin/
    ln -sv ../../opt/google/chrome/google-chrome

    cd $pkgdir/opt/google/chrome
    ln -sv ../../../usr/lib/mozilla/plugins

    cd $pkgdir/usr/share/applications
    ln -sv ../../../opt/google/chrome/google-chrome.desktop

    mkdir $pkgdir/opt/google/chrome/lib
    cd $pkgdir/opt/google/chrome/lib
    ln -sv /usr/lib/libnspr4.so libnspr4.so.0d
    ln -sv /usr/lib/libnss3.so libnss3.so.1d
    ln -sv /usr/lib/libnssutil3.so libnssutil3.so.1d
    ln -sv /usr/lib/libplc4.so libplc4.so.0d
    ln -sv /usr/lib/libplds4.so libplds4.so.0d
    ln -sv /usr/lib/libsmime3.so libsmime3.so.1d
    ln -sv /usr/lib/libssl3.so libssl3.so.1d

    #icons needs separate copying
    for i in 16 32 48 256;
    do
        install -d ${pkgdir}/usr/share/icons/hicolor/${i}x${i}/apps
        cp -v ${pkgdir}/opt/google/chrome/product_logo_${i}.png ${pkgdir}/usr/share/icons/hicolor/${i}x${i}/apps/google-chrome.png
    done
    cp -v ${pkgdir}/opt/google/chrome/product_logo_256.png ${pkgdir}/usr/share/icons/google-chrome.png
    msg2 "Installation finished!"
}
